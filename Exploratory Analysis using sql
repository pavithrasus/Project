create database project;
use project;
select * from table covid_deaths;
select * from table covid_vaccinations ;

select Location , date , total_cases , total_deaths , population 
from covid_deaths
order by Location , date ;

#to find the percentage of total deaths  for each location

select Location, date, total_cases, total_deaths , Round((total_deaths / total_cases)* 100 , 2)
from covid_deaths
order by Location , date;

#shows the liklihood of dying if you get infected with covid

select Location , date , total_cases , total_deaths , Round((total_deaths / total_cases) * 100 , 2)
from covid_deaths
where Location = "India"
order by date;

#shows what percentage of people got covid
select Location , date , total_cases , population , Round((total_cases / population) * 100 , 2) as infection_percentage
from covid_deaths
where Location = 'India'
order by date;

#countries with highest infection rate based on population
select Location , population , Max(total_cases) as maximum_cases , Max((total_cases/population) * 100) as infection_percentage
from covid_deaths
group by Location
order by infection_percentage;

#countries with highest death count per location
select Location , Max(cast(total_deaths as int)) as maximum_deaths # total_deaths is stored as a varchar hence changing it to int
from covid_deaths 
where continent is not null # since some locations are having continents has null value 
group by Location
order by maximum_deaths desc;

#maximum death count by continents
select continent , Max(cast(total_deaths as int)) as maximum_deaths
from covid_deaths
where continents is not null
group by continents
order by maximum_deaths desc;

#total number of new cases and deaths by date
select date , Max(new_cases) as total_newcase , Max(cast(new_deaths as int)) as total_newdeaths , sum(new_cases)/sum(cast(new_deaths as int)) * 100 as death_percentage
from covid_deaths
where continents is not null
group by date;

#global numbers
#total number of new cases and deaths in the world and its rate
select Max(new_cases) as total_newcase , Max(cast(new_deaths as int)) as total_newdeaths , Sum(new_cases) / Sum(cast(new_deaths as int)) * 100 as death_percentage
from covid_deaths
where continents is not null;

#total population vs vaccination per day
select d.continent , d.Location , d.date , d.population , v.new_vaccination 
from covid_deaths d
join covid_vaccinations v on d.Location = v.Location
and d.date = v.date
where continents is not null
order by d.Location , d.date;

#creating a cte
#total population vs vaccination per day the rolling people vaccinated and also to find the rate
with popvsvac (continent , location , date , population , new_vaccination)
as
(
select d.continent , d.location , d.date, d.population , v.new_vaccination , 
sum(convert(v.new_vaccinations , int)) over (partition by d.location order by d.location , d.date) as rolling_peoplevaccinated
from covid_deaths d
join covid_vaccinations v on d.Location = v.Location 
and d.date = v.date
where continents is not null
order by d.Location , d.date
)
select * , (rolling_peoplevaccinated/population) * 100
from popvsvac;

#total population vs max vaccination per location , also find the rolling people vaccinated and the rate


#creating a temporary table
create temporary table percentpopulation_vaccinated
(
continent varchar(255),
location varchar(255),
date datetime,
population numeric,
new_vaccination numeric,
rolling_peoplevaccinated numeric
);

insert into percentpopulation_vaccinated
(
select d.continent , d.location , d.date, d.population , v.new_vaccination , 
sum(convert(v.new_vaccinations , int)) over (partition by d.location order by d.location , d.date) as rolling_peoplevaccinated
from covid_deaths d
join covid_vaccinations v on d.Location = v.Location 
and d.date = v.date
where continents is not null
order by d.Location , d.date
);

select * , (rolling_peoplevaccinated/population) * 100 as rolling_peoplevacinnatedrate
from percentpopulation_vaccinated;

#creating a view for population vaccinated

create or replace view v_populationvaccinated as
select d.continent , d.location , d.date, d.population , v.new_vaccination , 
sum(convert(v.new_vaccinations , int)) over (partition by d.location order by d.location , d.date) as rolling_peoplevaccinated
from covid_deaths d
join covid_vaccinations v on d.Location = v.Location 
and d.date = v.date
where continents is not null
order by d.Location , d.date;

#creating a view for global data

create or replace view v_global as
select Max(new_cases) as total_newcase , Max(cast(new_deaths as int)) as total_newdeaths , Sum(new_cases) / Sum(cast(new_deaths as int)) * 100 as death_percentage
from covid_deaths
where continents is not null;





